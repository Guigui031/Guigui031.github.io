---
import { languages } from '../i18n/ui'
import { getLangFromUrl } from '../i18n/utils'

const currentLang = getLangFromUrl(Astro.url)
const currentPath = Astro.url.pathname

// Remove current language from path to get base path
const basePath = currentLang === 'en' ? currentPath : currentPath.replace(`/${currentLang}`, '') || '/'
---

<div class="dropdown dropdown-end">
  <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
    </svg>
    {languages[currentLang]}
  </div>
  <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-32 p-2 shadow">
    {Object.entries(languages).map(([lang, name]) => (
      <li>
        <a 
          href={lang === 'en' ? basePath : `/${lang}${basePath}`}
          class={lang === currentLang ? 'active' : ''}
        >
          {name}
        </a>
      </li>
    ))}
  </ul>
</div>